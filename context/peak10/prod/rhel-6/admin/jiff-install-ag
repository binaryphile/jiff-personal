#!/usr/bin/env bash
# Usage: jiff ag-install

source stdlib
source distrolib

AgVersion="${AgVersion:-0.31.0}"

read -d "" -a Prereqs <<EOM || :
pkgconfig
automake
gcc
zlib-devel
pcre-devel
xz-devel
EOM

main () {
  exit_if_is_on_path "ag"
  install_prereqs
  install_ag
}

install_ag () {
  mkdir -p "${HOME}/tmp"
  push_dir "${HOME}/tmp"
  wget "https://downloads.accns.com/the_silver_searcher-${AgVersion}.tar.gz"
  tar xzf "the_silver_searcher-${AgVersion}.tar.gz"
  cd "the_silver_searcher-${AgVersion}"
  ./configure
  make
  sudo make install
  cd ..
  rm -rf "the_silver_searcher-${AgVersion}"
  pop_dir
}

install_prereqs () {
  local prereq

  for prereq in "${Prereqs[@]}"; do
    install_package "${prereq}"
  done
}

return 0 2>/dev/null || :
strict_mode on
main "$@"
